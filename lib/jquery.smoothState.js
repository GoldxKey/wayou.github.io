(function(t,n,e,o){"use strict";if(!n.history.pushState){t.fn.smoothState=function(){return this};t.fn.smoothState.options={};return}if(t.fn.smoothState){return}var r=t("html, body"),a=n.console||false,i={anchors:"a",prefetch:false,blacklist:".no-smoothstate, [target]",development:false,pageCacheSize:0,alterRequestUrl:function(t){return t},onStart:{duration:0,render:function(){r.scrollTop(0)}},onProgress:{duration:0,render:function(){r.css("cursor","wait");r.find("a").css("cursor","wait")}},onEnd:{duration:0,render:function(t,n,e){r.css("cursor","auto");r.find("a").css("cursor","auto");n.html(e)}},callback:function(){}},s={isExternal:function(t){var e=t.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof e[1]==="string"&&e[1].length>0&&e[1].toLowerCase()!==n.location.protocol){return true}if(typeof e[2]==="string"&&e[2].length>0&&e[2].replace(new RegExp(":("+{"http:":80,"https:":443}[n.location.protocol]+")?$"),"")!==n.location.host){return true}return false},isHash:function(t,e){e=e||n.location.href;var o=t.indexOf("#")>-1?true:false,r=t.replace(/#.*/,"")===e.replace(/#.*/,"")?true:false;return o&&r},shouldLoad:function(t,n){var e=t.prop("href");return!s.isExternal(e)&&!s.isHash(e)&&!t.is(n)},htmlDoc:function(n){var e,o=t(),r=/<(\/?)(html|head|body|title|base|meta)(\s+[^>]*)?>/gi,a="ss"+Math.round(Math.random()*1e5),i=n.replace(r,function(n,e,r,i){var s={};if(!e){t.merge(o,t("<"+r+"/>"));if(i){t.each(t("<div"+i+"/>")[0].attributes,function(t,n){s[n.name]=n.value})}o.eq(-1).attr(s)}return"<"+e+"div"+(e?"":' id="'+a+(o.length-1)+'"')+">"});if(!o.length){return t(n)}if(!e){e=t("<div/>")}e.html(i);t.each(o,function(t){var n=e.find("#"+a+t).before(o[t]);o.eq(t).html(n.contents());n.remove()});return e.children().unwrap()},clearIfOverCapacity:function(t,n){if(!Object.keys){Object.keys=function(t){var n=[],e;for(e in t){if(Object.prototype.hasOwnProperty.call(t,e)){n.push(e)}}return n}}if(Object.keys(t).length>n){t={}}return t},getContentById:function(n,e){e=e instanceof jQuery?e:s.htmlDoc(e);var o=e.find(n),r=o.length?t.trim(o.html()):e.filter(n).html(),a=r.length?t(r):null;return a},storePageIn:function(t,n,e){e=e instanceof jQuery?e:s.htmlDoc(e);t[n]={status:"loaded",title:e.find("title").text(),html:e};return t},triggerAllAnimationEndEvent:function(n,e){e=" "+e||"";var o=0,r="animationstart webkitAnimationStart oanimationstart MSAnimationStart",a="animationend webkitAnimationEnd oanimationend MSAnimationEnd",i="allanimationend",l=function(e){if(t(e.delegateTarget).is(n)){e.stopPropagation();o++}},f=function(e){if(t(e.delegateTarget).is(n)){e.stopPropagation();o--;if(o===0){n.trigger(i)}}};n.on(r,l);n.on(a,f);n.on("allanimationend"+e,function(){o=0;s.redraw(n)})},redraw:function(t){t.height()}},l=function(e){if(e.state!==null){var o=n.location.href,r=t("#"+e.state.id),a=r.data("smoothState");if(a.href!==o&&!s.isHash(o,a.href)){a.load(o,true)}}},f=function(o,r){var i=t(o),l={},f=n.location.href,c=function(n,e){e=e||null;if(l.hasOwnProperty(n)){return}l=s.clearIfOverCapacity(l,r.pageCacheSize);l[n]={status:"fetching"};var o=r.alterRequestUrl(n)||n,a=t.ajax(o,{dataType:"html"});a.success(function(t){s.storePageIn(l,n,t);i.data("smoothState").cache=l});a.error(function(){l[n].status="error"});if(e){a.complete(e)}},u=function(t){var o="#"+i.prop("id"),f=l[t]?s.getContentById(o,l[t].html):null;if(f){e.title=l[t].title;i.data("smoothState").href=t;r.onEnd.render(t,i,f,l[t].html);i.one("ss.onEndEnd",function(){r.callback(t,i,f,l[t].html)});n.setTimeout(function(){i.trigger("ss.onEndEnd")},r.onEnd.duration)}else if(!f&&r.development&&a){a.warn("No element with an id of "+o+" in response from "+t+" in "+l)}else{n.location=t}},d=function(t,e){e=e||false;var o=false,s=false,f={loaded:function(){var r=o?"ss.onProgressEnd":"ss.onStartEnd";if(!s||!o){i.one(r,function(){u(t)})}else if(s){u(t)}if(!e){n.history.pushState({id:i.prop("id")},l[t].title,t)}},fetching:function(){if(!o){o=true;i.one("ss.onStartEnd",function(){r.onProgress.render(t,i,null);n.setTimeout(function(){i.trigger("ss.onProgressEnd");s=true},r.onStart.duration)})}n.setTimeout(function(){if(l.hasOwnProperty(t)){f[l[t].status]()}},10)},error:function(){if(r.development&&a){a.log("There was an error loading: "+t)}else{n.location=t}}};if(!l.hasOwnProperty(t)){c(t)}r.onStart.render(t,i,null);n.setTimeout(function(){i.trigger("ss.onStartEnd")},r.onStart.duration);f[l[t].status]()},h=function(n){var e=t(n.currentTarget),o=e.prop("href");if(s.shouldLoad(e,r.blacklist)){n.stopPropagation();c(o)}},m=function(n){var e=t(n.currentTarget),o=e.prop("href");if(!n.metaKey&&!n.ctrlKey&&s.shouldLoad(e,r.blacklist)){n.stopPropagation();n.preventDefault();d(o)}},p=function(t){t.on("click",r.anchors,m);if(r.prefetch){t.on("mouseover touchstart",r.anchors,h)}},g=function(t){var e=i.addClass(t).prop("class");i.removeClass(e);n.setTimeout(function(){i.addClass(e)},0);i.one("ss.onStartEnd ss.onProgressEnd ss.onEndEnd",function(){i.removeClass(t)})},v=function(){var t=i.prop("class");i.removeClass(t);s.redraw(i);i.addClass(t)};r=t.extend({},t.fn.smoothState.options,r);if(n.history.state===null){n.history.replaceState({id:i.prop("id")},e.title,f)}s.storePageIn(l,f,e.documentElement.outerHTML);s.triggerAllAnimationEndEvent(i,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd");p(i);return{href:f,cache:l,load:d,fetch:c,toggleAnimationClass:g,restartCSSAnimations:v}},c=function(n){return this.each(function(){if(this.id&&!t.data(this,"smoothState")){t.data(this,"smoothState",new f(this,n))}else if(!this.id&&a){a.warn("Every smoothState container needs an id but the following one does not have one:",this)}})};n.onpopstate=l;t.smoothStateUtility=s;t.fn.smoothState=c;t.fn.smoothState.options=i})(jQuery,window,document);