<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>刘哇勇的部落格</title><meta name="author" content="wayou"><meta name="description" content="HTML5 Audio API showcase | Audio visualizer
        
            html, body {
                margin: 0;
                font-family: arial, &quot;Microsof"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:site_name" content="刘哇勇的部落格"><meta property="og:image" content="undefined"><link href="/favicon.png" rel="icon"><link rel="stylesheet" href="/css/jquery.tocify.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css"><link rel="stylesheet" href="/material/css/ripples.css" media="screen" type="text/css"><link rel="stylesheet" href="/material/css/material.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css"><link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><script src="/js/jquery-2.0.3.min.js"></script></head><body><nav id="main-nav" class="navbar navbar-default" role="navigation"><div class="container"><button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">刘哇勇的部落格</a><div class="collapse navbar-collapse nav-menu"><ul class="nav navbar-nav navbar-right"><li><a href="/"><i class="fa fa-home"></i>首页</a></li><li><a href="/archives"><i class="fa fa-list"></i>存档</a></li><li><a href="/categories"><i class="fa fa-folder"></i>分类</a></li><li><a href="/about"><i class="fa fa-info-circle"></i>关于</a></li><li><a href="/atom.xml"><i class="fa fa-rss"></i>RSS</a></li></ul></div></div></nav><div class="clearfix"></div><div class="container"><div class="content"><div class="page-header"><h1></h1></div><div class="row page"><div class="col-md-12"><div class="mypage"><div class="row widget-wrapper"><div class="post-meta-item"><i class="fa fa-clock-o"></i> <span class="post-time">2014-08-25 22:18:56</span></div></div><!DOCTYPE html><html><head><meta name="description" content="HTML5 Audio Spectrum Visualizer"><title>HTML5 Audio API showcase | Audio visualizer</title><style type="text/css">html, body {
                margin: 0;
                font-family: arial, "Microsoft YaHei";
                background-color: #272822;
                color: #FEFEFE;
            }
            #fileWrapper{
                transition:all 0.5s ease;
            }
            #fileWrapper:hover{
                opacity: 1!important;
            }
            #visualizer_wrapper{
                text-align: center;
            }
            footer{
                position: fixed;
                bottom: 2px;
                color:#aaa;
            }</style></head><body><div id="wrapper"><div id="fileWrapper" class="file_wrapper"><div id="info">HTML5 Audio API showcase | An Audio Viusalizer</div><label for="uploadedFile">Drag&drop or select a file to play:</label><input type="file" id="uploadedFile"></div><div id="visualizer_wrapper"><canvas id="canvas" width="800" height="350"></canvas></div></div><footer><small>Star me on <a href="https://github.com/Wayou/HTML5_Audio_Visualizer" target="_blank">GitHub</a></small></footer><script type="text/javascript">window.onload=function(){(new Visualizer).ini()};var Visualizer=function(){this.file=null,this.fileName=null,this.audioContext=null,this.source=null,this.info=document.getElementById("info").innerHTML,this.infoUpdateId=null,this.animationId=null,this.status=0,this.forceStop=!1,this.allCapsReachBottom=!1};Visualizer.prototype={ini:function(){this._prepareAPI(),this._addEventListner()},_prepareAPI:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;try{this.audioContext=new AudioContext}catch(t){this._updateInfo("!Your browser does not support AudioContext",!1),console.log(t)}},_addEventListner:function(){var t=this,e=document.getElementById("uploadedFile"),n=document.getElementsByTagName("canvas")[0];e.onchange=function(){0!==e.files.length&&(t.file=e.files[0],t.fileName=t.file.name,1===t.status&&(t.forceStop=!0),document.getElementById("fileWrapper").style.opacity=1,t._updateInfo("Uploading",!0),t._start())},n.addEventListener("dragenter",function(){document.getElementById("fileWrapper").style.opacity=1,t._updateInfo("Drop it on the page",!0)},!1),n.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},!1),n.addEventListener("dragleave",function(){document.getElementById("fileWrapper").style.opacity=.2,t._updateInfo(t.info,!1)},!1),n.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),document.getElementById("fileWrapper").style.opacity=1,t._updateInfo("Uploading",!0),t.file=e.dataTransfer.files[0],1===t.status&&(document.getElementById("fileWrapper").style.opacity=1,t.forceStop=!0),t.fileName=t.file.name,t._start()},!1)},_start:function(){var t=this,e=this.file,n=new FileReader;n.onload=function(e){var n=e.target.result,i=t.audioContext;null!==i&&(t._updateInfo("Decoding the audio",!0),i.decodeAudioData(n,function(e){t._updateInfo("Decode succussfully,start the visualizer",!0),t._visualize(i,e)},function(e){t._updateInfo("!Fail to decode the file",!1),console.log(e)}))},n.onerror=function(e){t._updateInfo("!Fail to read the file",!1),console.log(e)},this._updateInfo("Starting read the file",!0),n.readAsArrayBuffer(e)},_visualize:function(t,e){var n=t.createBufferSource(),i=t.createAnalyser(),o=this;n.connect(i),i.connect(t.destination),n.buffer=e,n.start||(n.start=n.noteOn,n.stop=n.noteOff),null!==this.animationId&&cancelAnimationFrame(this.animationId),null!==this.source&&this.source.stop(0),n.start(0),this.status=1,this.source=n,n.onended=function(){o._audioEnd(o)},this._updateInfo("Playing "+this.fileName,!1),this.info="Playing "+this.fileName,document.getElementById("fileWrapper").style.opacity=.2,this._drawSpectrum(i)},_drawSpectrum:function(t){var e=this,n=document.getElementById("canvas"),i=n.width,o=n.height-2,a=10,r=2,d="#fff",l=800/12,s=[];ctx=n.getContext("2d"),gradient=ctx.createLinearGradient(0,0,0,300),gradient.addColorStop(1,"#0f0"),gradient.addColorStop(.5,"#ff0"),gradient.addColorStop(0,"#f00");var u=function(){var n=new Uint8Array(t.frequencyBinCount);if(t.getByteFrequencyData(n),0===e.status){for(var c=n.length-1;c>=0;c--)n[c]=0;allCapsReachBottom=!0;for(var c=s.length-1;c>=0;c--)allCapsReachBottom=allCapsReachBottom&&0===s[c];if(allCapsReachBottom)return void cancelAnimationFrame(e.animationId)}var f=Math.round(n.length/l);ctx.clearRect(0,0,i,o);for(var c=0;l>c;c++){var m=n[c*f];s.length<Math.round(l)&&s.push(m),ctx.fillStyle=d,m<s[c]?ctx.fillRect(12*c,o- --s[c],a,r):(ctx.fillRect(12*c,o-m,a,r),s[c]=m),ctx.fillStyle=gradient,ctx.fillRect(12*c,o-m+r,a,o)}e.animationId=requestAnimationFrame(u)};this.animationId=requestAnimationFrame(u)},_audioEnd:function(t){if(this.forceStop)return this.forceStop=!1,void(this.status=1);this.status=0;var e="HTML5 Audio API showcase | An Audio Viusalizer";document.getElementById("fileWrapper").style.opacity=1,document.getElementById("info").innerHTML=e,t.info=e,document.getElementById("uploadedFile").value=""},_updateInfo:function(t,e){var n=document.getElementById("info"),i="...",o=0,a=this;if(n.innerHTML=t+i.substring(0,o++),null!==this.infoUpdateId&&clearTimeout(this.infoUpdateId),e){var r=function(){o>3&&(o=0),n.innerHTML=t+i.substring(0,o++),a.infoUpdateId=setTimeout(r,250)};this.infoUpdateId=setTimeout(r,250)}}};</script><script>!function(e,a,n,t,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(n),s=a.getElementsByTagName(n)[0],o.async=1,o.src=t,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-46794744-3","duapp.com"),ga("send","pageview");</script></body></html></div><div><center><div class="pagination-wrapper"></div></center></div></div></div></div></div><div class="container-narrow"><footer><p>&copy; 2014 <i class="icon-material-keyboard-arrow-left" style="font-size: 10pt"></i>/<i class="icon-material-keyboard-arrow-right" style="font-size: 10pt"></i> with <i class="icon icon-material-favorite icon-material-red" style="font-size: 10pt"></i> by <a href="http://wayou.github.io">wayou</a> with the help of <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a></p></footer></div><a id="gotop" href="#"><span>▲</span></a><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script src="/js/bootstrap.min.js"></script><script src="/material/js/ripples.js"></script><script src="/material/js/material.js"></script><script src="/js/jqueryui.js"></script><script src="/js/jquery.tocify.js"></script><script src="/js/main.js"></script></body></html>