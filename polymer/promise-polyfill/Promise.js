function MakePromise(t){function e(t){if(typeof this!=="object"||typeof t!=="function")throw new TypeError;this._state=null;this._value=null;this._deferreds=[];u(t,r.bind(this),i.bind(this))}function n(e){var n=this;if(this._state===null){this._deferreds.push(e);return}t(function(){var t=n._state?e.onFulfilled:e.onRejected;if(typeof t!=="function"){(n._state?e.resolve:e.reject)(n._value);return}var r;try{r=t(n._value)}catch(i){e.reject(i);return}e.resolve(r)})}function r(t){try{if(t===this)throw new TypeError;if(t&&(typeof t==="object"||typeof t==="function")){var e=t.then;if(typeof e==="function"){u(e.bind(t),r.bind(this),i.bind(this));return}}this._state=true;this._value=t;o.call(this)}catch(n){i.call(this,n)}}function i(t){this._state=false;this._value=t;o.call(this)}function o(){for(var t=0,e=this._deferreds.length;t<e;t++){n.call(this,this._deferreds[t])}this._deferreds=null}function u(t,e,n){var r=false;try{t(function(t){if(r)return;r=true;e(t)},function(t){if(r)return;r=true;n(t)})}catch(i){if(r)return;r=true;n(i)}}e.prototype["catch"]=function(t){return this.then(null,t)};e.prototype.then=function(t,r){var i=this;return new e(function(e,o){n.call(i,{onFulfilled:t,onRejected:r,resolve:e,reject:o})})};e.resolve=function(t){if(t&&typeof t==="object"&&t.constructor===e){return t}return new e(function(e){e(t)})};e.reject=function(t){return new e(function(e,n){n(t)})};return e}if(typeof module!=="undefined"){module.exports=MakePromise}