"use strict";var jsdoc=require("./jsdoc");var dom5=require("dom5");var ELEMENT_CONFIGURATION=["attached","attributeChanged","configure","constructor","created","detached","enableCustomStyleProperties","extends","hostAttributes","is","listeners","mixins","observers","properties","ready","registered"];var HANDLED_TAGS=["param","return","type"];function annotate(e){if(!e||e.jsdoc)return e;if(typeof e.desc==="string"){e.jsdoc=jsdoc.parseJsdoc(e.desc);e.jsdoc.orig=e.desc;e.desc=e.jsdoc.body}return e}function annotateElementHeader(e){if(e.events){e.events.forEach(function(e){_annotateEvent(e)});e.events.sort(function(e,t){return e.name.localeCompare(t.name)})}e.demos=[];if(e.jsdoc&&e.jsdoc.tags){e.jsdoc.tags.forEach(function(t){switch(t.tag){case"hero":e.hero=t.name||"hero.png";break;case"demo":e.demos.push({desc:t.body||"demo",path:t.name||"demo/index.html"})}})}}function annotateElement(e){if(!e.desc&&e.type==="element"){e.desc=_findElementDocs(e.is,e.domModule,e.scriptElement)}annotate(e);delete e.domModule;e.properties.forEach(function(t){annotateProperty(t,e.abstract)});e.properties.sort(function(e,t){if(e.private&&!t.private){return 1}else if(!e.private&&t.private){return-1}else{return e.name.localeCompare(t.name)}});annotateElementHeader(e);return e}function annotateBehavior(e){annotate(e);annotateElementHeader(e);return e}function _annotateEvent(e){annotate(e);var t=jsdoc.getTag(e.jsdoc,"event");e.name=t?t.name:"N/A";e.params=(e.jsdoc.tags||[]).filter(function(e){return e.tag==="param"}).map(function(e){return{type:e.type||"N/A",desc:e.body,name:e.name||"N/A"}});return e}function annotateProperty(e,t){annotate(e);if(e.name[0]==="_"||jsdoc.hasTag(e.jsdoc,"private")){e.private=true}if(!t&&ELEMENT_CONFIGURATION.indexOf(e.name)!==-1){e.private=true;e.configuration=true}e.type=jsdoc.getTag(e.jsdoc,"type","type")||e.type;if(e.type.match(/^function/i)){_annotateFunctionProperty(e)}var n=jsdoc.getTag(e.jsdoc,"default");if(n!==null){e.default=(n.name||"")+(n.body||"")}return e}function _annotateFunctionProperty(e){e.function=true;var t=jsdoc.getTag(e.jsdoc,"return");if(t){e.return={type:t.type,desc:t.body}}var n={};(e.params||[]).forEach(function(e){n[e.name]=e});(e.jsdoc&&e.jsdoc.tags||[]).forEach(function(e){if(e.tag!=="param")return;var t=n[e.name];if(!t){return}t.type=e.type||t.type;t.desc=e.body})}function featureElement(e){var t=e.reduce(function(e,t){return e.concat(t.properties)},[]);return{type:"element",is:"Polymer.Base","abstract":true,properties:t,desc:"`Polymer.Base` acts as a base prototype for all Polymer "+"elements. It is composed via various calls to "+"`Polymer.Base._addFeature()`.\n"+"\n"+"The properties reflected here are the combined view of all "+"features found in this library. There may be more properties "+"added via other libraries, as well."}}function clean(e){if(!e.jsdoc)return;delete e.jsdoc.body;delete e.jsdoc.orig;var t=[];(e.jsdoc.tags||[]).forEach(function(e){if(HANDLED_TAGS.indexOf(e.tag)!==-1)return;t.push(e)});if(t.length===0){delete e.jsdoc}else{e.jsdoc.tags=t}}function cleanElement(e){clean(e);e.properties.forEach(cleanProperty)}function cleanProperty(e){clean(e)}function _findElementDocs(e,t,n){var r=[];var a=t||n;var o=dom5.nodeWalkAllPrior(a,dom5.isCommentNode);var s=o.length>0?o[0]:null;if(s&&s.data){r.push(s.data)}if(r.length===0)return null;return r.filter(function(e){if(e&&e.indexOf("@license"===-1)){return true}else{return false}}).map(jsdoc.unindent).join("\n")}function _findLastChildNamed(e,t){var n=t.childNodes;for(var r=n.length-1,a;r>=0;r--){a=n[r];if(a.nodeName===e)return a}return null}function _getNodeAttribute(e,t){for(var n=0,r;n<e.attrs.length;n++){r=e.attrs[n];if(r.name===t){return r.value}}}module.exports={annotate:annotate,annotateElement:annotateElement,annotateBehavior:annotateBehavior,clean:clean,cleanElement:cleanElement,featureElement:featureElement};